{"version":3,"file":"router.js","names":["computed","nextTick","onScopeDispose","reactive","resolveDynamicComponent","toRef","deepEqual","getCurrentInstance","hasEvent","IN_BROWSER","propsFactory","useRoute","vm","proxy","$route","useRouter","$router","useLink","props","attrs","RouterLink","isLink","href","to","isClickable","value","isRouterLink","linkProps","route","undefined","navigate","routerLink","replace","link","isActive","exact","isExactActive","query","disabled","tabindex","makeRouterProps","String","Boolean","Object","inTransition","useBackButton","router","cb","popped","removeBefore","removeAfter","beforeEach","window","addEventListener","onPopstate","from","next","setTimeout","afterEach","removeEventListener","e","state","replaced"],"sources":["../../src/composables/router.tsx"],"sourcesContent":["// Utilities\nimport {\n  computed,\n  nextTick,\n  onScopeDispose, reactive,\n  resolveDynamicComponent,\n  toRef,\n} from 'vue'\nimport { deepEqual, getCurrentInstance, hasEvent, IN_BROWSER, propsFactory } from '@/util'\n\n// Types\nimport type { PropType, Ref, SetupContext } from 'vue'\nimport type {\n  RouterLink as _RouterLink,\n  useLink as _useLink,\n  NavigationGuardNext,\n  RouteLocation,\n  RouteLocationNormalizedLoaded,\n  RouteLocationRaw,\n  Router,\n} from 'vue-router'\nimport type { EventProp } from '@/util'\n\nexport function useRoute (): Ref<RouteLocationNormalizedLoaded | undefined> {\n  const vm = getCurrentInstance('useRoute')\n\n  return computed(() => vm?.proxy?.$route)\n}\n\nexport function useRouter (): Router | undefined {\n  return getCurrentInstance('useRouter')?.proxy?.$router\n}\n\nexport interface LinkProps {\n  href: string | undefined\n  replace: boolean | undefined\n  to: RouteLocationRaw | undefined\n  exact: boolean | undefined\n  disabled: boolean | undefined\n}\n\nexport interface LinkListeners {\n  onClick?: EventProp | undefined\n  onClickOnce?: EventProp | undefined\n}\n\nexport interface UseLink extends Omit<Partial<ReturnType<typeof _useLink>>, 'href'|'route'|'navigate'> {\n  isLink: Readonly<Ref<boolean>>\n  isRouterLink: Readonly<Ref<boolean>>\n  isClickable: Readonly<Ref<boolean>>\n  href: Ref<string | undefined>\n  linkProps: Record<string, string | undefined>\n  route: Readonly<Ref<RouteLocation & { href: string} | undefined>>\n  navigate: Readonly<Ref<ReturnType<typeof _useLink>['navigate'] | undefined>>\n}\n\nexport function useLink (props: LinkProps & LinkListeners, attrs: SetupContext['attrs']): UseLink {\n  const RouterLink = resolveDynamicComponent('RouterLink') as typeof _RouterLink | string\n\n  const isLink = toRef(() => !!(props.href || props.to))\n  const isClickable = computed(() => {\n    return isLink?.value || hasEvent(attrs, 'click') || hasEvent(props, 'click')\n  })\n\n  if (typeof RouterLink === 'string' || !('useLink' in RouterLink)) {\n    const href = toRef(() => props.href)\n    return {\n      isLink,\n      isRouterLink: toRef(() => false),\n      isClickable,\n      href,\n      linkProps: reactive({ href }),\n      route: toRef(() => undefined),\n      navigate: toRef(() => undefined),\n    }\n  }\n\n  // vue-router useLink `to` prop needs to be reactive and useLink will crash if undefined\n  const routerLink = RouterLink.useLink({\n    to: toRef(() => props.to || ''),\n    replace: toRef(() => props.replace),\n  })\n  // Actual link needs to be undefined when to prop is not used\n  const link = computed(() => props.to ? routerLink : undefined)\n  const route = useRoute()\n  const isActive = computed(() => {\n    if (!link.value) return false\n    if (!props.exact) return link.value.isActive?.value ?? false\n    if (!route.value) return link.value.isExactActive?.value ?? false\n\n    return link.value.isExactActive?.value && deepEqual(link.value.route.value.query, route.value.query)\n  })\n  const href = computed(() => props.to ? link.value?.route.value.href : props.href)\n  const isRouterLink = toRef(() => !!props.to)\n\n  return {\n    isLink,\n    isRouterLink,\n    isClickable,\n    isActive,\n    route: toRef(() => link.value?.route.value),\n    navigate: toRef(() => link.value?.navigate),\n    href,\n    linkProps: reactive({\n      href,\n      'aria-current': toRef(() => isActive.value ? 'page' : undefined),\n      'aria-disabled': toRef(() => props.disabled && isLink.value ? 'true' : undefined),\n      tabindex: toRef(() => props.disabled && isLink.value ? '-1' : undefined),\n    }),\n  }\n}\n\nexport const makeRouterProps = propsFactory({\n  href: String,\n  replace: Boolean,\n  to: [String, Object] as PropType<RouteLocationRaw>,\n  exact: Boolean,\n}, 'router')\n\nlet inTransition = false\nexport function useBackButton (router: Router | undefined, cb: (next: NavigationGuardNext) => void) {\n  let popped = false\n  let removeBefore: (() => void) | undefined\n  let removeAfter: (() => void) | undefined\n\n  if (IN_BROWSER && router?.beforeEach) {\n    nextTick(() => {\n      window.addEventListener('popstate', onPopstate)\n      removeBefore = router.beforeEach((to, from, next) => {\n        if (!inTransition) {\n          setTimeout(() => popped ? cb(next) : next())\n        } else {\n          popped ? cb(next) : next()\n        }\n        inTransition = true\n      })\n      removeAfter = router?.afterEach(() => {\n        inTransition = false\n      })\n    })\n    onScopeDispose(() => {\n      window.removeEventListener('popstate', onPopstate)\n      removeBefore?.()\n      removeAfter?.()\n    })\n  }\n\n  function onPopstate (e: PopStateEvent) {\n    if (e.state?.replaced) return\n\n    popped = true\n    setTimeout(() => (popped = false))\n  }\n}\n"],"mappings":"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","ignoreList":[]}