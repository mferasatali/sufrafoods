{"version":3,"file":"useCommandPaletteNavigation.js","names":["readonly","ref","shallowRef","watch","isActionItem","getItemKey","item","undefined","value","String","title","findFirstSelectableIndex","items","findIndex","useCommandPaletteNavigation","options","selectedIndex","selectedItemKey","filteredItems","newItems","oldItems","length","newIndex","firstSelectableIndex","immediate","getSelectedItem","execute","index","event","onItemClick","executeSelected","reset","setSelectedIndex"],"sources":["../../../../src/labs/VCommandPalette/composables/useCommandPaletteNavigation.ts"],"sourcesContent":["// Utilities\nimport { readonly, ref, shallowRef, watch } from 'vue'\n\n// Types\nimport type { ComputedRef, Ref } from 'vue'\nimport type { VCommandPaletteItem } from '../types'\nimport { isActionItem } from '../types'\n\nexport interface UseCommandPaletteNavigationOptions {\n  filteredItems: ComputedRef<VCommandPaletteItem[]>\n  onItemClick: (item: VCommandPaletteItem, event: KeyboardEvent | MouseEvent) => void\n}\n\nexport interface UseCommandPaletteNavigationReturn {\n  selectedIndex: Readonly<Ref<number>>\n  getSelectedItem: () => VCommandPaletteItem | undefined\n  execute: (index: number, event: KeyboardEvent | MouseEvent) => void\n  executeSelected: (event: KeyboardEvent | MouseEvent) => void\n  reset: () => void\n  setSelectedIndex: (index: number) => void\n}\n\nfunction getItemKey (item: VCommandPaletteItem): string | undefined {\n  if (!isActionItem(item)) return undefined\n  return item.value !== undefined ? String(item.value) : item.title\n}\n\nfunction findFirstSelectableIndex (items: VCommandPaletteItem[]): number {\n  return items.findIndex(item => isActionItem(item))\n}\n\nexport function useCommandPaletteNavigation (\n  options: UseCommandPaletteNavigationOptions\n): UseCommandPaletteNavigationReturn {\n  const selectedIndex = ref(0)\n  const selectedItemKey = shallowRef<string | undefined>(undefined)\n\n  watch(() => options.filteredItems.value, (newItems, oldItems) => {\n    if (newItems.length === 0) {\n      selectedIndex.value = -1\n      selectedItemKey.value = undefined\n      return\n    }\n\n    if (selectedItemKey.value !== undefined) {\n      const newIndex = newItems.findIndex(item =>\n        isActionItem(item) && getItemKey(item) === selectedItemKey.value\n      )\n      if (newIndex !== -1) {\n        selectedIndex.value = newIndex\n        return\n      }\n    }\n\n    const firstSelectableIndex = findFirstSelectableIndex(newItems)\n    if (firstSelectableIndex !== -1) {\n      selectedIndex.value = firstSelectableIndex\n      selectedItemKey.value = getItemKey(newItems[firstSelectableIndex])\n      return\n    }\n\n    selectedIndex.value = 0\n    selectedItemKey.value = undefined\n  }, { immediate: true })\n\n  function getSelectedItem (): VCommandPaletteItem | undefined {\n    return options.filteredItems.value[selectedIndex.value]\n  }\n\n  function execute (index: number, event: KeyboardEvent | MouseEvent) {\n    const item = options.filteredItems.value[index]\n    if (item) {\n      options.onItemClick(item, event)\n    }\n  }\n\n  function executeSelected (event: KeyboardEvent | MouseEvent) {\n    const item = getSelectedItem()\n    if (item) {\n      options.onItemClick(item, event)\n    }\n  }\n\n  function reset () {\n    const items = options.filteredItems.value\n\n    if (items.length === 0) {\n      selectedIndex.value = -1\n      selectedItemKey.value = undefined\n      return\n    }\n\n    const firstSelectableIndex = findFirstSelectableIndex(items)\n    if (firstSelectableIndex !== -1) {\n      selectedIndex.value = firstSelectableIndex\n      selectedItemKey.value = getItemKey(items[firstSelectableIndex])\n      return\n    }\n\n    selectedIndex.value = 0\n    selectedItemKey.value = undefined\n  }\n\n  function setSelectedIndex (index: number) {\n    // Ignore VList's reset to -1 when we have items - we manage selection on filter changes\n    if (index === -1 && options.filteredItems.value.length > 0) {\n      return\n    }\n    selectedIndex.value = index\n    const item = options.filteredItems.value[index]\n    selectedItemKey.value = item ? getItemKey(item) : undefined\n  }\n\n  return {\n    selectedIndex: readonly(selectedIndex),\n    getSelectedItem,\n    execute,\n    executeSelected,\n    reset,\n    setSelectedIndex,\n  }\n}\n"],"mappings":"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","ignoreList":[]}