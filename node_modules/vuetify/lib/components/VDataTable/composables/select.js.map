{"version":3,"file":"select.js","names":["useProxiedModel","computed","inject","provide","shallowRef","toRef","toValue","deepEqual","isPrimitive","propsFactory","wrapInArray","singleSelectStrategy","showSelectAll","allSelected","select","_ref","items","value","Set","selectAll","_ref2","selected","pageSelectStrategy","_ref3","currentPage","_ref4","item","add","delete","_ref5","allSelectStrategy","_ref6","allItems","_ref7","_ref8","map","makeDataTableSelectProps","showSelect","Boolean","selectStrategy","type","String","Object","default","modelValue","Array","valueComparator","Function","VDataTableSelectionSymbol","Symbol","for","provideSelection","props","_ref9","v","customComparator","find","values","allSelectable","filter","selectable","currentPageSelectable","lastSelectedIndex","isSelected","every","has","isSomeSelected","some","newSelected","toggleSelect","index","event","pageItems","findIndex","i","shiftKey","start","end","sort","a","b","push","slice","someSelected","size","length","data","useSelection","Error"],"sources":["../../../../src/components/VDataTable/composables/select.ts"],"sourcesContent":["// Composables\nimport { useProxiedModel } from '@/composables/proxiedModel'\n\n// Utilities\nimport { computed, inject, provide, shallowRef, toRef, toValue } from 'vue'\nimport { deepEqual, isPrimitive, propsFactory, wrapInArray } from '@/util'\n\n// Types\nimport type { InjectionKey, MaybeRefOrGetter, PropType, Ref } from 'vue'\nimport type { DataTableItemProps } from './items'\nimport type { EventProp, ValueComparator } from '@/util'\n\nexport interface SelectableItem {\n  value: any\n  selectable: boolean\n}\n\nexport interface DataTableSelectStrategy {\n  showSelectAll: boolean\n  allSelected: (data: {\n    allItems: SelectableItem[]\n    currentPage: SelectableItem[]\n  }) => SelectableItem[]\n  select: (data: {\n    items: SelectableItem[]\n    value: boolean\n    selected: Set<unknown>\n  }) => Set<unknown>\n  selectAll: (data: {\n    value: boolean\n    allItems: SelectableItem[]\n    currentPage: SelectableItem[]\n    selected: Set<unknown>\n  }) => Set<unknown>\n}\n\ntype SelectionProps = Pick<DataTableItemProps, 'itemValue'> & {\n  modelValue: readonly any[]\n  selectStrategy: 'single' | 'page' | 'all'\n  valueComparator?: ValueComparator\n  'onUpdate:modelValue': EventProp<[any[]]> | undefined\n}\n\nconst singleSelectStrategy: DataTableSelectStrategy = {\n  showSelectAll: false,\n  allSelected: () => [],\n  select: ({ items, value }) => {\n    return new Set(value ? [items[0]?.value] : [])\n  },\n  selectAll: ({ selected }) => selected,\n}\n\nconst pageSelectStrategy: DataTableSelectStrategy = {\n  showSelectAll: true,\n  allSelected: ({ currentPage }) => currentPage,\n  select: ({ items, value, selected }) => {\n    for (const item of items) {\n      if (value) selected.add(item.value)\n      else selected.delete(item.value)\n    }\n\n    return selected\n  },\n  selectAll: ({ value, currentPage, selected }) => pageSelectStrategy.select({ items: currentPage, value, selected }),\n}\n\nconst allSelectStrategy: DataTableSelectStrategy = {\n  showSelectAll: true,\n  allSelected: ({ allItems }) => allItems,\n  select: ({ items, value, selected }) => {\n    for (const item of items) {\n      if (value) selected.add(item.value)\n      else selected.delete(item.value)\n    }\n\n    return selected\n  },\n  selectAll: ({ value, allItems }) => {\n    return new Set(value ? allItems.map(item => item.value) : [])\n  },\n}\n\nexport const makeDataTableSelectProps = propsFactory({\n  showSelect: Boolean,\n  selectStrategy: {\n    type: [String, Object] as PropType<'single' | 'page' | 'all'>,\n    default: 'page',\n  },\n  modelValue: {\n    type: Array as PropType<readonly any[]>,\n    default: () => ([]),\n  },\n  valueComparator: Function as PropType<ValueComparator>,\n}, 'DataTable-select')\n\nexport const VDataTableSelectionSymbol: InjectionKey<ReturnType<typeof provideSelection>> = Symbol.for('vuetify:data-table-selection')\n\nexport function provideSelection (\n  props: SelectionProps,\n  { allItems, currentPage }: { allItems: Ref<SelectableItem[]>, currentPage: MaybeRefOrGetter<readonly SelectableItem[]> }\n) {\n  const selected = useProxiedModel(props, 'modelValue', props.modelValue, v => {\n    const customComparator = props.valueComparator\n    if (customComparator) {\n      return new Set(wrapInArray(v).map(v => {\n        return allItems.value.find(item => customComparator(v, item.value))?.value ?? v\n      }))\n    }\n    return new Set(wrapInArray(v).map(v => {\n      return isPrimitive(v)\n        ? allItems.value.find(item => v === item.value)?.value ?? v\n        : allItems.value.find(item => deepEqual(v, item.value))?.value ?? v\n    }))\n  }, v => {\n    return [...v.values()]\n  })\n\n  const allSelectable = computed(() => allItems.value.filter(item => item.selectable))\n  const currentPageSelectable = computed(() => toValue(currentPage).filter(item => item.selectable))\n\n  const selectStrategy = computed(() => {\n    if (typeof props.selectStrategy === 'object') return props.selectStrategy\n\n    switch (props.selectStrategy) {\n      case 'single': return singleSelectStrategy\n      case 'all': return allSelectStrategy\n      case 'page':\n      default: return pageSelectStrategy\n    }\n  })\n\n  const lastSelectedIndex = shallowRef<number | null>(null)\n\n  function isSelected (items: SelectableItem | SelectableItem[]) {\n    return wrapInArray(items).every(item => selected.value.has(item.value))\n  }\n\n  function isSomeSelected (items: SelectableItem | SelectableItem[]) {\n    return wrapInArray(items).some(item => selected.value.has(item.value))\n  }\n\n  function select (items: SelectableItem[], value: boolean) {\n    const newSelected = selectStrategy.value.select({\n      items,\n      value,\n      selected: new Set(selected.value),\n    })\n\n    selected.value = newSelected\n  }\n\n  function toggleSelect (item: SelectableItem, index?: number, event?: MouseEvent) {\n    const items = []\n    const pageItems = toValue(currentPage)\n    index = index ?? pageItems.findIndex(i => i.value === item.value)\n\n    if (props.selectStrategy !== 'single' && event?.shiftKey && lastSelectedIndex.value !== null) {\n      const [start, end] = [lastSelectedIndex.value, index].sort((a, b) => a - b)\n\n      items.push(...pageItems.slice(start, end + 1).filter(item => item.selectable))\n    } else {\n      items.push(item)\n      lastSelectedIndex.value = index\n    }\n\n    select(items, !isSelected([item]))\n  }\n\n  function selectAll (value: boolean) {\n    const newSelected = selectStrategy.value.selectAll({\n      value,\n      allItems: allSelectable.value,\n      currentPage: currentPageSelectable.value,\n      selected: new Set(selected.value),\n    })\n\n    selected.value = newSelected\n  }\n\n  const someSelected = computed(() => selected.value.size > 0)\n  const allSelected = computed(() => {\n    const items = selectStrategy.value.allSelected({\n      allItems: allSelectable.value,\n      currentPage: currentPageSelectable.value,\n    })\n    return !!items.length && isSelected(items)\n  })\n  const showSelectAll = toRef(() => selectStrategy.value.showSelectAll)\n\n  const data = {\n    toggleSelect,\n    select,\n    selectAll,\n    isSelected,\n    isSomeSelected,\n    someSelected,\n    allSelected,\n    showSelectAll,\n    lastSelectedIndex,\n    selectStrategy,\n  }\n\n  provide(VDataTableSelectionSymbol, data)\n\n  return data\n}\n\nexport function useSelection () {\n  const data = inject(VDataTableSelectionSymbol)\n\n  if (!data) throw new Error('Missing selection!')\n\n  return data\n}\n"],"mappings":"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","ignoreList":[]}