{"version":3,"file":"paginate.js","names":["useProxiedModel","computed","inject","provide","toValue","watch","clamp","getCurrentInstance","propsFactory","makeDataTablePaginateProps","page","type","Number","String","default","itemsPerPage","pageBy","VDataTablePaginationSymbol","Symbol","for","createPagination","props","undefined","value","providePagination","options","itemsLength","startIndex","stopIndex","Math","min","pageCount","ceil","setItemsPerPage","nextPage","prevPage","setPage","data","usePagination","Error","usePaginatedItems","vm","items","paginatedItems","slice","val","emit","immediate","usePaginatedGroups","sortedItems","paginate","group","flatItems","paginatedItemsWithGroups","groups","paginatedGroups","length","firstGroupId","at","id","lastGroupId","start","findIndex","item","lastGroupIndex","stop","i","depth"],"sources":["../../../../src/components/VDataTable/composables/paginate.ts"],"sourcesContent":["// Composables\nimport { useProxiedModel } from '@/composables/proxiedModel'\n\n// Utilities\nimport { computed, inject, provide, toValue, watch } from 'vue'\nimport { clamp, getCurrentInstance, propsFactory } from '@/util'\n\n// Types\nimport type { ComputedRef, InjectionKey, MaybeRefOrGetter, PropType, Ref } from 'vue'\nimport type { Group, GroupableItem, GroupSummary } from './group'\nimport type { EventProp } from '@/util'\n\nexport const makeDataTablePaginateProps = propsFactory({\n  page: {\n    type: [Number, String],\n    default: 1,\n  },\n  itemsPerPage: {\n    type: [Number, String],\n    default: 10,\n  },\n  pageBy: {\n    type: String as PropType<'item' | 'any' | 'auto'>,\n    default: 'any',\n  },\n}, 'DataTable-paginate')\n\nexport type VDataTablePaginationInjectionData = {\n  page: Ref<number>\n  itemsPerPage: Ref<number>\n  startIndex: Ref<number>\n  stopIndex: Ref<number>\n  pageCount: Ref<number>\n  itemsLength: Ref<number>\n  prevPage: () => void\n  nextPage: () => void\n  setPage: (value: number) => void\n  setItemsPerPage: (value: number) => void\n}\n\nconst VDataTablePaginationSymbol: InjectionKey<VDataTablePaginationInjectionData> = Symbol.for('vuetify:data-table-pagination')\n\ntype PaginationProps = {\n  page: number | string\n  'onUpdate:page': EventProp | undefined\n  itemsPerPage: number | string\n  'onUpdate:itemsPerPage': EventProp | undefined\n  itemsLength?: number | string\n}\n\nexport function createPagination (props: PaginationProps) {\n  const page = useProxiedModel(props, 'page', undefined, value => Number(value ?? 1))\n  const itemsPerPage = useProxiedModel(props, 'itemsPerPage', undefined, value => Number(value ?? 10))\n\n  return { page, itemsPerPage }\n}\n\nexport function providePagination (options: {\n  page: Ref<number>\n  itemsPerPage: Ref<number>\n  itemsLength: Ref<number>\n}) {\n  const { page, itemsPerPage, itemsLength } = options\n\n  const startIndex = computed(() => {\n    if (itemsPerPage.value === -1) return 0\n\n    return itemsPerPage.value * (page.value - 1)\n  })\n  const stopIndex = computed(() => {\n    if (itemsPerPage.value === -1) return itemsLength.value\n\n    return Math.min(itemsLength.value, startIndex.value + itemsPerPage.value)\n  })\n\n  const pageCount = computed(() => {\n    if (itemsPerPage.value === -1 || itemsLength.value === 0) return 1\n\n    return Math.ceil(itemsLength.value / itemsPerPage.value)\n  })\n\n  // Don't run immediately, items may not have been loaded yet: #17966\n  watch([page, pageCount], () => {\n    if (page.value > pageCount.value) {\n      page.value = pageCount.value\n    }\n  })\n\n  function setItemsPerPage (value: number) {\n    itemsPerPage.value = value\n    page.value = 1\n  }\n\n  function nextPage () {\n    page.value = clamp(page.value + 1, 1, pageCount.value)\n  }\n\n  function prevPage () {\n    page.value = clamp(page.value - 1, 1, pageCount.value)\n  }\n\n  function setPage (value: number) {\n    page.value = clamp(value, 1, pageCount.value)\n  }\n\n  const data = { page, itemsPerPage, startIndex, stopIndex, pageCount, itemsLength, nextPage, prevPage, setPage, setItemsPerPage }\n\n  provide(VDataTablePaginationSymbol, data)\n\n  return data\n}\n\nexport function usePagination () {\n  const data = inject(VDataTablePaginationSymbol)\n\n  if (!data) throw new Error('Missing pagination!')\n\n  return data\n}\n\nexport function usePaginatedItems <T> (options: {\n  items: MaybeRefOrGetter<readonly T[]>\n  startIndex: Ref<number>\n  stopIndex: Ref<number>\n  itemsPerPage: Ref<number>\n}) {\n  const vm = getCurrentInstance('usePaginatedItems')\n\n  const { items, startIndex, stopIndex, itemsPerPage } = options\n  const paginatedItems = computed(() => {\n    if (itemsPerPage.value <= 0) return toValue(items)\n\n    return toValue(items).slice(startIndex.value, stopIndex.value)\n  })\n\n  watch(paginatedItems, val => {\n    vm.emit('update:currentItems', val)\n  }, { immediate: true })\n\n  return { paginatedItems }\n}\n\nexport function usePaginatedGroups <T extends GroupableItem> (options: {\n  pageBy: ComputedRef<'item' | 'group' | 'any'>\n  sortedItems: Ref<readonly T[]>\n  paginate: <TItem>(items: MaybeRefOrGetter<readonly TItem[]>) => {\n    paginatedItems: ComputedRef<readonly TItem[]>\n    pageCount: ComputedRef<number>\n    setItemsPerPage: (value: number) => void\n  }\n  group: (items: MaybeRefOrGetter<readonly T[]>) => {\n    flatItems: ComputedRef<readonly (T | Group<T> | GroupSummary<T>)[]>\n    groups: ComputedRef<readonly Group<T>[]>\n  }\n}) {\n  const { sortedItems, paginate, group } = options\n  const pageBy = toValue(options.pageBy) // TODO: make reactive\n\n  if (pageBy === 'item') {\n    const { paginatedItems, pageCount, setItemsPerPage } = paginate(sortedItems)\n    const { flatItems: paginatedItemsWithGroups } = group(paginatedItems)\n\n    return {\n      pageCount,\n      setItemsPerPage,\n      paginatedItems: paginatedItemsWithGroups,\n    }\n  }\n\n  if (pageBy === 'group') {\n    const { flatItems, groups } = group(sortedItems)\n    const { paginatedItems: paginatedGroups, pageCount, setItemsPerPage } = paginate(groups)\n    const paginatedItemsWithGroups = computed(() => {\n      if (!paginatedGroups.value.length) return []\n      const firstGroupId = paginatedGroups.value.at(0)!.id\n      const lastGroupId = paginatedGroups.value.at(-1)!.id\n      const start = flatItems.value.findIndex(item => item.type === 'group' && item.id === firstGroupId)\n      const lastGroupIndex = flatItems.value.findIndex(item => item.type === 'group' && item.id === lastGroupId)\n      const stop = flatItems.value.findIndex((item, i) => i > lastGroupIndex && item.type === 'group' && item.depth === 0)\n      return flatItems.value.slice(start, stop === -1 ? undefined : stop)\n    })\n\n    return {\n      pageCount,\n      setItemsPerPage,\n      paginatedItems: paginatedItemsWithGroups,\n    }\n  }\n\n  if (pageBy === 'any') {\n    const { flatItems } = group(sortedItems)\n    const { paginatedItems: paginatedItemsWithGroups, pageCount, setItemsPerPage } = paginate(flatItems)\n\n    return {\n      pageCount,\n      setItemsPerPage,\n      paginatedItems: paginatedItemsWithGroups,\n    }\n  }\n\n  throw new Error(`Unrecognized pagination target ${pageBy}`)\n}\n"],"mappings":"AAAA;AAAA,SACSA,eAAe,gDAExB;AACA,SAASC,QAAQ,EAAEC,MAAM,EAAEC,OAAO,EAAEC,OAAO,EAAEC,KAAK,QAAQ,KAAK;AAAA,SACtDC,KAAK,EAAEC,kBAAkB,EAAEC,YAAY,kCAEhD;AAKA,OAAO,MAAMC,0BAA0B,GAAGD,YAAY,CAAC;EACrDE,IAAI,EAAE;IACJC,IAAI,EAAE,CAACC,MAAM,EAAEC,MAAM,CAAC;IACtBC,OAAO,EAAE;EACX,CAAC;EACDC,YAAY,EAAE;IACZJ,IAAI,EAAE,CAACC,MAAM,EAAEC,MAAM,CAAC;IACtBC,OAAO,EAAE;EACX,CAAC;EACDE,MAAM,EAAE;IACNL,IAAI,EAAEE,MAA2C;IACjDC,OAAO,EAAE;EACX;AACF,CAAC,EAAE,oBAAoB,CAAC;AAexB,MAAMG,0BAA2E,GAAGC,MAAM,CAACC,GAAG,CAAC,+BAA+B,CAAC;AAU/H,OAAO,SAASC,gBAAgBA,CAAEC,KAAsB,EAAE;EACxD,MAAMX,IAAI,GAAGV,eAAe,CAACqB,KAAK,EAAE,MAAM,EAAEC,SAAS,EAAEC,KAAK,IAAIX,MAAM,CAACW,KAAK,IAAI,CAAC,CAAC,CAAC;EACnF,MAAMR,YAAY,GAAGf,eAAe,CAACqB,KAAK,EAAE,cAAc,EAAEC,SAAS,EAAEC,KAAK,IAAIX,MAAM,CAACW,KAAK,IAAI,EAAE,CAAC,CAAC;EAEpG,OAAO;IAAEb,IAAI;IAAEK;EAAa,CAAC;AAC/B;AAEA,OAAO,SAASS,iBAAiBA,CAAEC,OAIlC,EAAE;EACD,MAAM;IAAEf,IAAI;IAAEK,YAAY;IAAEW;EAAY,CAAC,GAAGD,OAAO;EAEnD,MAAME,UAAU,GAAG1B,QAAQ,CAAC,MAAM;IAChC,IAAIc,YAAY,CAACQ,KAAK,KAAK,CAAC,CAAC,EAAE,OAAO,CAAC;IAEvC,OAAOR,YAAY,CAACQ,KAAK,IAAIb,IAAI,CAACa,KAAK,GAAG,CAAC,CAAC;EAC9C,CAAC,CAAC;EACF,MAAMK,SAAS,GAAG3B,QAAQ,CAAC,MAAM;IAC/B,IAAIc,YAAY,CAACQ,KAAK,KAAK,CAAC,CAAC,EAAE,OAAOG,WAAW,CAACH,KAAK;IAEvD,OAAOM,IAAI,CAACC,GAAG,CAACJ,WAAW,CAACH,KAAK,EAAEI,UAAU,CAACJ,KAAK,GAAGR,YAAY,CAACQ,KAAK,CAAC;EAC3E,CAAC,CAAC;EAEF,MAAMQ,SAAS,GAAG9B,QAAQ,CAAC,MAAM;IAC/B,IAAIc,YAAY,CAACQ,KAAK,KAAK,CAAC,CAAC,IAAIG,WAAW,CAACH,KAAK,KAAK,CAAC,EAAE,OAAO,CAAC;IAElE,OAAOM,IAAI,CAACG,IAAI,CAACN,WAAW,CAACH,KAAK,GAAGR,YAAY,CAACQ,KAAK,CAAC;EAC1D,CAAC,CAAC;;EAEF;EACAlB,KAAK,CAAC,CAACK,IAAI,EAAEqB,SAAS,CAAC,EAAE,MAAM;IAC7B,IAAIrB,IAAI,CAACa,KAAK,GAAGQ,SAAS,CAACR,KAAK,EAAE;MAChCb,IAAI,CAACa,KAAK,GAAGQ,SAAS,CAACR,KAAK;IAC9B;EACF,CAAC,CAAC;EAEF,SAASU,eAAeA,CAAEV,KAAa,EAAE;IACvCR,YAAY,CAACQ,KAAK,GAAGA,KAAK;IAC1Bb,IAAI,CAACa,KAAK,GAAG,CAAC;EAChB;EAEA,SAASW,QAAQA,CAAA,EAAI;IACnBxB,IAAI,CAACa,KAAK,GAAGjB,KAAK,CAACI,IAAI,CAACa,KAAK,GAAG,CAAC,EAAE,CAAC,EAAEQ,SAAS,CAACR,KAAK,CAAC;EACxD;EAEA,SAASY,QAAQA,CAAA,EAAI;IACnBzB,IAAI,CAACa,KAAK,GAAGjB,KAAK,CAACI,IAAI,CAACa,KAAK,GAAG,CAAC,EAAE,CAAC,EAAEQ,SAAS,CAACR,KAAK,CAAC;EACxD;EAEA,SAASa,OAAOA,CAAEb,KAAa,EAAE;IAC/Bb,IAAI,CAACa,KAAK,GAAGjB,KAAK,CAACiB,KAAK,EAAE,CAAC,EAAEQ,SAAS,CAACR,KAAK,CAAC;EAC/C;EAEA,MAAMc,IAAI,GAAG;IAAE3B,IAAI;IAAEK,YAAY;IAAEY,UAAU;IAAEC,SAAS;IAAEG,SAAS;IAAEL,WAAW;IAAEQ,QAAQ;IAAEC,QAAQ;IAAEC,OAAO;IAAEH;EAAgB,CAAC;EAEhI9B,OAAO,CAACc,0BAA0B,EAAEoB,IAAI,CAAC;EAEzC,OAAOA,IAAI;AACb;AAEA,OAAO,SAASC,aAAaA,CAAA,EAAI;EAC/B,MAAMD,IAAI,GAAGnC,MAAM,CAACe,0BAA0B,CAAC;EAE/C,IAAI,CAACoB,IAAI,EAAE,MAAM,IAAIE,KAAK,CAAC,qBAAqB,CAAC;EAEjD,OAAOF,IAAI;AACb;AAEA,OAAO,SAASG,iBAAiBA,CAAMf,OAKtC,EAAE;EACD,MAAMgB,EAAE,GAAGlC,kBAAkB,CAAC,mBAAmB,CAAC;EAElD,MAAM;IAAEmC,KAAK;IAAEf,UAAU;IAAEC,SAAS;IAAEb;EAAa,CAAC,GAAGU,OAAO;EAC9D,MAAMkB,cAAc,GAAG1C,QAAQ,CAAC,MAAM;IACpC,IAAIc,YAAY,CAACQ,KAAK,IAAI,CAAC,EAAE,OAAOnB,OAAO,CAACsC,KAAK,CAAC;IAElD,OAAOtC,OAAO,CAACsC,KAAK,CAAC,CAACE,KAAK,CAACjB,UAAU,CAACJ,KAAK,EAAEK,SAAS,CAACL,KAAK,CAAC;EAChE,CAAC,CAAC;EAEFlB,KAAK,CAACsC,cAAc,EAAEE,GAAG,IAAI;IAC3BJ,EAAE,CAACK,IAAI,CAAC,qBAAqB,EAAED,GAAG,CAAC;EACrC,CAAC,EAAE;IAAEE,SAAS,EAAE;EAAK,CAAC,CAAC;EAEvB,OAAO;IAAEJ;EAAe,CAAC;AAC3B;AAEA,OAAO,SAASK,kBAAkBA,CAA4BvB,OAY7D,EAAE;EACD,MAAM;IAAEwB,WAAW;IAAEC,QAAQ;IAAEC;EAAM,CAAC,GAAG1B,OAAO;EAChD,MAAMT,MAAM,GAAGZ,OAAO,CAACqB,OAAO,CAACT,MAAM,CAAC,EAAC;;EAEvC,IAAIA,MAAM,KAAK,MAAM,EAAE;IACrB,MAAM;MAAE2B,cAAc;MAAEZ,SAAS;MAAEE;IAAgB,CAAC,GAAGiB,QAAQ,CAACD,WAAW,CAAC;IAC5E,MAAM;MAAEG,SAAS,EAAEC;IAAyB,CAAC,GAAGF,KAAK,CAACR,cAAc,CAAC;IAErE,OAAO;MACLZ,SAAS;MACTE,eAAe;MACfU,cAAc,EAAEU;IAClB,CAAC;EACH;EAEA,IAAIrC,MAAM,KAAK,OAAO,EAAE;IACtB,MAAM;MAAEoC,SAAS;MAAEE;IAAO,CAAC,GAAGH,KAAK,CAACF,WAAW,CAAC;IAChD,MAAM;MAAEN,cAAc,EAAEY,eAAe;MAAExB,SAAS;MAAEE;IAAgB,CAAC,GAAGiB,QAAQ,CAACI,MAAM,CAAC;IACxF,MAAMD,wBAAwB,GAAGpD,QAAQ,CAAC,MAAM;MAC9C,IAAI,CAACsD,eAAe,CAAChC,KAAK,CAACiC,MAAM,EAAE,OAAO,EAAE;MAC5C,MAAMC,YAAY,GAAGF,eAAe,CAAChC,KAAK,CAACmC,EAAE,CAAC,CAAC,CAAC,CAAEC,EAAE;MACpD,MAAMC,WAAW,GAAGL,eAAe,CAAChC,KAAK,CAACmC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAEC,EAAE;MACpD,MAAME,KAAK,GAAGT,SAAS,CAAC7B,KAAK,CAACuC,SAAS,CAACC,IAAI,IAAIA,IAAI,CAACpD,IAAI,KAAK,OAAO,IAAIoD,IAAI,CAACJ,EAAE,KAAKF,YAAY,CAAC;MAClG,MAAMO,cAAc,GAAGZ,SAAS,CAAC7B,KAAK,CAACuC,SAAS,CAACC,IAAI,IAAIA,IAAI,CAACpD,IAAI,KAAK,OAAO,IAAIoD,IAAI,CAACJ,EAAE,KAAKC,WAAW,CAAC;MAC1G,MAAMK,IAAI,GAAGb,SAAS,CAAC7B,KAAK,CAACuC,SAAS,CAAC,CAACC,IAAI,EAAEG,CAAC,KAAKA,CAAC,GAAGF,cAAc,IAAID,IAAI,CAACpD,IAAI,KAAK,OAAO,IAAIoD,IAAI,CAACI,KAAK,KAAK,CAAC,CAAC;MACpH,OAAOf,SAAS,CAAC7B,KAAK,CAACqB,KAAK,CAACiB,KAAK,EAAEI,IAAI,KAAK,CAAC,CAAC,GAAG3C,SAAS,GAAG2C,IAAI,CAAC;IACrE,CAAC,CAAC;IAEF,OAAO;MACLlC,SAAS;MACTE,eAAe;MACfU,cAAc,EAAEU;IAClB,CAAC;EACH;EAEA,IAAIrC,MAAM,KAAK,KAAK,EAAE;IACpB,MAAM;MAAEoC;IAAU,CAAC,GAAGD,KAAK,CAACF,WAAW,CAAC;IACxC,MAAM;MAAEN,cAAc,EAAEU,wBAAwB;MAAEtB,SAAS;MAAEE;IAAgB,CAAC,GAAGiB,QAAQ,CAACE,SAAS,CAAC;IAEpG,OAAO;MACLrB,SAAS;MACTE,eAAe;MACfU,cAAc,EAAEU;IAClB,CAAC;EACH;EAEA,MAAM,IAAId,KAAK,CAAC,kCAAkCvB,MAAM,EAAE,CAAC;AAC7D","ignoreList":[]}