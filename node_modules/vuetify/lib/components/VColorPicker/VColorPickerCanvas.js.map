{"version":3,"file":"VColorPickerCanvas.js","names":["makeComponentProps","useResizeObserver","computed","onMounted","ref","shallowRef","toRef","watch","clamp","convertToUnit","defineComponent","getEventCoordinates","propsFactory","useRender","makeVColorPickerCanvasProps","color","type","Object","disabled","Boolean","readonly","dotSize","Number","String","default","height","width","VColorPickerCanvas","name","props","emits","hue","setup","_ref","emit","isInteracting","canvasRef","canvasWidth","parseFloat","canvasHeight","_dotPosition","x","y","isInteractive","dotPosition","get","value","set","val","h","s","v","a","dotStyles","radius","parseInt","transform","resizeRef","entries","el","offsetParent","contentRect","Math","round","updateDotPosition","rect","left","top","handleMouseDown","e","preventDefault","handleMouseMove","window","addEventListener","handleMouseUp","coords","clientX","clientY","getBoundingClientRect","removeEventListener","updateCanvas","canvas","ctx","getContext","saturationGradient","createLinearGradient","addColorStop","fillStyle","fillRect","valueGradient","immediate","newVal","oldVal","flush","deep","_createElementVNode","_normalizeClass","class","_normalizeStyle","style"],"sources":["../../../src/components/VColorPicker/VColorPickerCanvas.tsx"],"sourcesContent":["// Styles\nimport './VColorPickerCanvas.sass'\n\n// Composables\nimport { makeComponentProps } from '@/composables/component'\nimport { useResizeObserver } from '@/composables/resizeObserver'\n\n// Utilities\nimport { computed, onMounted, ref, shallowRef, toRef, watch } from 'vue'\nimport { clamp, convertToUnit, defineComponent, getEventCoordinates, propsFactory, useRender } from '@/util'\n\n// Types\nimport type { PropType } from 'vue'\nimport type { HSV } from '@/util'\n\nexport const makeVColorPickerCanvasProps = propsFactory({\n  color: {\n    type: Object as PropType<HSV | null>,\n  },\n  disabled: Boolean,\n  readonly: Boolean,\n  dotSize: {\n    type: [Number, String],\n    default: 10,\n  },\n  height: {\n    type: [Number, String],\n    default: 150,\n  },\n  width: {\n    type: [Number, String],\n    default: 300,\n  },\n\n  ...makeComponentProps(),\n}, 'VColorPickerCanvas')\n\nexport const VColorPickerCanvas = defineComponent({\n  name: 'VColorPickerCanvas',\n\n  props: makeVColorPickerCanvasProps(),\n\n  emits: {\n    'update:color': (color: HSV) => true,\n    'update:position': (hue: any) => true,\n  },\n\n  setup (props, { emit }) {\n    const isInteracting = shallowRef(false)\n    const canvasRef = ref<HTMLCanvasElement | null>()\n    const canvasWidth = shallowRef(parseFloat(props.width))\n    const canvasHeight = shallowRef(parseFloat(props.height))\n\n    const _dotPosition = ref({ x: 0, y: 0 })\n    const isInteractive = toRef(() => !props.disabled && !props.readonly)\n\n    const dotPosition = computed({\n      get: () => _dotPosition.value,\n      set (val) {\n        if (!canvasRef.value) return\n\n        const { x, y } = val\n        _dotPosition.value = val\n\n        emit('update:color', {\n          h: props.color?.h ?? 0,\n          s: clamp(x, 0, canvasWidth.value) / canvasWidth.value,\n          v: 1 - clamp(y, 0, canvasHeight.value) / canvasHeight.value,\n          a: props.color?.a ?? 1,\n        })\n      },\n    })\n\n    const dotStyles = computed(() => {\n      const { x, y } = dotPosition.value\n      const radius = parseInt(props.dotSize, 10) / 2\n\n      return {\n        width: convertToUnit(props.dotSize),\n        height: convertToUnit(props.dotSize),\n        transform: `translate(${convertToUnit(x - radius)}, ${convertToUnit(y - radius)})`,\n      }\n    })\n\n    const { resizeRef } = useResizeObserver(entries => {\n      if (!resizeRef.el?.offsetParent) return\n\n      const { width, height } = entries[0].contentRect\n\n      canvasWidth.value = Math.round(width)\n      canvasHeight.value = Math.round(height)\n    })\n\n    function updateDotPosition (x: number, y: number, rect: DOMRect) {\n      const { left, top, width, height } = rect\n      dotPosition.value = {\n        x: clamp(x - left, 0, width),\n        y: clamp(y - top, 0, height),\n      }\n    }\n\n    function handleMouseDown (e: MouseEvent | TouchEvent) {\n      if (e.type === 'mousedown') {\n        // Prevent text selection while dragging\n        e.preventDefault()\n      }\n\n      if (!isInteractive.value) return\n\n      handleMouseMove(e)\n\n      window.addEventListener('mousemove', handleMouseMove)\n      window.addEventListener('mouseup', handleMouseUp)\n      window.addEventListener('touchmove', handleMouseMove)\n      window.addEventListener('touchend', handleMouseUp)\n    }\n\n    function handleMouseMove (e: MouseEvent | TouchEvent) {\n      if (!isInteractive.value || !canvasRef.value) return\n\n      isInteracting.value = true\n\n      const coords = getEventCoordinates(e)\n\n      updateDotPosition(coords.clientX, coords.clientY, canvasRef.value.getBoundingClientRect())\n    }\n\n    function handleMouseUp () {\n      window.removeEventListener('mousemove', handleMouseMove)\n      window.removeEventListener('mouseup', handleMouseUp)\n      window.removeEventListener('touchmove', handleMouseMove)\n      window.removeEventListener('touchend', handleMouseUp)\n    }\n\n    function updateCanvas () {\n      if (!canvasRef.value) return\n\n      const canvas = canvasRef.value\n      const ctx = canvas.getContext('2d')\n\n      if (!ctx) return\n\n      const saturationGradient = ctx.createLinearGradient(0, 0, canvas.width, 0)\n      saturationGradient.addColorStop(0, 'hsla(0, 0%, 100%, 1)') // white\n      saturationGradient.addColorStop(1, `hsla(${props.color?.h ?? 0}, 100%, 50%, 1)`)\n      ctx.fillStyle = saturationGradient\n      ctx.fillRect(0, 0, canvas.width, canvas.height)\n\n      const valueGradient = ctx.createLinearGradient(0, 0, 0, canvas.height)\n      valueGradient.addColorStop(0, 'hsla(0, 0%, 0%, 0)') // transparent\n      valueGradient.addColorStop(1, 'hsla(0, 0%, 0%, 1)') // black\n      ctx.fillStyle = valueGradient\n      ctx.fillRect(0, 0, canvas.width, canvas.height)\n    }\n\n    watch(() => props.color?.h, updateCanvas, { immediate: true })\n    watch(() => [canvasWidth.value, canvasHeight.value], (newVal, oldVal) => {\n      updateCanvas()\n      _dotPosition.value = {\n        x: dotPosition.value.x * newVal[0] / oldVal[0],\n        y: dotPosition.value.y * newVal[1] / oldVal[1],\n      }\n    }, { flush: 'post' })\n\n    watch(() => props.color, () => {\n      if (isInteracting.value) {\n        isInteracting.value = false\n        return\n      }\n\n      _dotPosition.value = props.color ? {\n        x: props.color.s * canvasWidth.value,\n        y: (1 - props.color.v) * canvasHeight.value,\n      } : { x: 0, y: 0 }\n    }, { deep: true, immediate: true })\n\n    onMounted(() => updateCanvas())\n\n    useRender(() => (\n      <div\n        ref={ resizeRef }\n        class={[\n          'v-color-picker-canvas',\n          props.class,\n        ]}\n        style={ props.style }\n        onMousedown={ handleMouseDown }\n        onTouchstartPassive={ handleMouseDown }\n      >\n        <canvas\n          ref={ canvasRef }\n          width={ canvasWidth.value }\n          height={ canvasHeight.value }\n        />\n        { props.color && (\n          <div\n            class={[\n              'v-color-picker-canvas__dot',\n              {\n                'v-color-picker-canvas__dot--disabled': props.disabled,\n              },\n            ]}\n            style={ dotStyles.value }\n          />\n        )}\n      </div>\n    ))\n\n    return {}\n  },\n})\n\nexport type VColorPickerCanvas = InstanceType<typeof VColorPickerCanvas>\n"],"mappings":"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","ignoreList":[]}